<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Submit Complaint with Image</title>
  <style>
    body { font-family: Arial, sans-serif; background:#fff8e1; margin:0; padding:0; }
    .container { width:50%; margin:40px auto; background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { text-align:center; background:#ffd369; padding:12px; border-radius:8px; }
    label { display:block; margin-top:15px; font-weight:bold; }
    input, select, textarea { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; }
    textarea { height:120px; resize:none; }
    .btn { margin-top:20px; width:100%; padding:12px; background:#ffd369; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
    .issue { background:#fafafa; border:1px solid #ddd; border-radius:8px; padding:12px; margin-top:10px; }
    .issue img { max-width:200px; margin-top:10px; border-radius:8px; border:1px solid #ccc; }
  header {
      background: #ffd369;
      color: white;
      padding: 15px;
      text-align: center;
    }

    nav {
      background: #ffd369;
      display: flex;
      justify-content: center;
      padding: 10px;
    }
    
   .btndeleteBtn {
  float: right;              /* Pushes button to the right */
  margin-top: 5px;           /* Smaller top margin */
  padding: 6px 10px 1px;         /* Smaller padding */
  width: auto;               /* Auto width instead of full */
  background: #ffd369;
  border: none;
  border-radius: 6px;        /* Slightly smaller radius */
  font-weight: bold;
  cursor: pointer;
  font-size: 0.85em;         /* Slightly smaller text */
}


    nav a {
      color: white;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    </style>
</head>
<body>
  <header>
    <h1>Hostel Issue Portal</h1>
    <p>Welcome, Student! Report and track your hostel issues easily.</p>
  </header>

  <nav>
    <a href="#">Home</a>
    <a href="#">Report Issue</a>
    <a href="#">My Issues</a>
    <a href="student_homepage.html">Back</a>
    <a href="home_page.html">Logout</a>
  </nav>

  <div class="container">
    <h2>Submit a Complaint</h2>
    <form id="complaintForm">
      <label for="hostel">Select Your Hostel</label>
      <select id="hostel" required>
        <option value="">Choose your hostel</option>
        <option value="terekhol-girls">Terekhol (Girls Hostel)</option>
        <option value="talpona-boys">Talpona (Boys Hostel)</option>
      </select>

      <label for="category">Issue Category</label>
      <select id="category" required>
        <option value="">Select an issue</option>
        <option value="water">Water Leakage</option>
        <option value="electricity">Power Cut</option>
        <option value="cleanliness">Cleanliness</option>
        <option value="wifi">WiFi Issue</option>
        <option value="other">Other</option>
      </select>

      <label for="room">Room Number</label>
      <input type="text" id="room" placeholder="Enter your room number" required>

      <label for="description">Complaint Description</label>
      <textarea id="description" placeholder="Describe your problem..." required></textarea>

      <label for="photo">Upload Image (optional)</label>
      <input type="file" id="photo" accept="image/*">

      <button type="submit" class="btn">Submit Complaint</button>
    </form>

    <h2 style="margin-top:30px;">My Complaints</h2>
    <div id="issueList"></div>
  </div>

  <script>
  const STORAGE_KEY = 'student_complaints_v1';
  const form = document.getElementById('complaintForm');
  const issueList = document.getElementById('issueList');

  function loadComplaints() {
    const raw = localStorage.getItem(STORAGE_KEY);
    try { return raw ? JSON.parse(raw) : []; }
    catch(e){ localStorage.removeItem(STORAGE_KEY); return []; }
  }

  function saveComplaints(list) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
      reader.readAsDataURL(file);
    });
  }

  async function handleSubmit(e) {
    e.preventDefault();
    const hostel = document.getElementById('hostel').value;
    const category = document.getElementById('category').value;
    const room = document.getElementById('room').value.trim();
    const description = document.getElementById('description').value.trim();
    const photoInput = document.getElementById('photo');

    if (!hostel || !category || !room || !description) {
      alert("Please fill all required fields.");
      return;
    }

    let photoData = "";
    if (photoInput.files.length > 0) {
      const file = photoInput.files[0];
      photoData = await toBase64(file);
    }

    const list = loadComplaints();
    const item = {
      id: Date.now(),
      hostel,
      category,
      room,
      description,
      time: Date.now(),
      status: "pending",
      photo: photoData
    };
    list.push(item);
    saveComplaints(list);
    form.reset();
    renderComplaints();
  }

  function deleteComplaint(id) {
    let list = loadComplaints();
    list = list.filter(item => item.id !== id);
    saveComplaints(list);
    renderComplaints();
  }

  function renderComplaints() {
    const list = loadComplaints();
    issueList.innerHTML = '';
    if (list.length === 0) {
      issueList.innerHTML = '<div class="small">No complaints submitted yet.</div>';
      return;
    }
    
    list.slice().reverse().forEach(item => {
      const el = document.createElement('div');
      el.className = 'issue';
      el.innerHTML = `
        <strong>${item.category}</strong> - ${item.hostel}, Room ${item.room}
        <div class="small">${new Date(item.time).toLocaleString()}</div>
        <p>${item.description}</p>
        ${item.photo ? `<img src="${item.photo}" alt="Attached photo">` : ''}
        <button class="btn deleteBtn">Delete</button>
      `;
      const deleteBtn = el.querySelector('.deleteBtn');
      deleteBtn.addEventListener('click', () => deleteComplaint(item.id));
      issueList.appendChild(el);
    });
    el.innerHTML = `
  <strong>${item.category}</strong> - ${item.hostel}, Room ${item.room}
  <div class="small">${new Date(item.time).toLocaleString()}</div>
  <p>${item.description}</p>
  ${item.photo ? `<img src="${item.photo}" alt="Attached photo">` : ''}
  <button class="btndeleteBtn">Delete</button>
`;

  }

  form.addEventListener('submit', handleSubmit);
  renderComplaints();
</script>

</body>
</html>
